function uploadToGoogleDrive(blob, credential) {
    const tokenData = parseJwt(credential);

    const reader = new FileReader();
    reader.readAsDataURL(blob);
    reader.onloadend = () => {
        const base64data = reader.result.split(',')[1];

        // Initialize the Google API client
        gapi.load('client:auth2', () => {
            gapi.auth2.init({
                client_id: 'YOUR_CLIENT_ID'
            }).then(() => {
                gapi.client.init({
                    apiKey: 'YOUR_API_KEY',
                    discoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"]
                }).then(() => {
                    gapi.auth.setToken({
                        access_token: tokenData.access_token
                    });

                    const fileMetadata = {
                        'name': 'recording.wav',
                        'parents': ['YOUR_FOLDER_ID'] // Replace with your folder ID
                    };
                    const media = {
                        mimeType: 'audio/wav',
                        body: new Blob([new Uint8Array(atob(base64data).split("").map((char) => char.charCodeAt(0)))])
                    };
                    gapi.client.drive.files.create({
                        resource: fileMetadata,
                        media: media,
                        fields: 'id'
                    }).then((response) => {
                        console.log('File uploaded successfully, ID: ', response.result.id);
                    }, (error) => {
                        console.error('Error uploading file: ', error);
                    });
                }).catch((error) => {
                    console.error('Error initializing Google API client: ', error);
                });
            }).catch((error) => {
                console.error('Error initializing Google Auth2: ', error);
            });
        });
    };
}

function parseJwt(token) {
    let base64Url = token.split('.')[1];
    let base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
    let jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
    }).join(''));

    return JSON.parse(jsonPayload);
}
